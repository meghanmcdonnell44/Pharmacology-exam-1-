<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NCLEX-Style Timed Exam — Form C (Balanced)</title>
<style>
  :root {
    --bg: #0b0f17;
    --panel: #121a29;
    --panel2: #0f1624;
    --text: #e8edf7;
    --muted: #a8b3c7;
    --accent: #5dd6ff;
    --danger: #ff5d7a;
    --ok: #52ffa8;
    --border: rgba(255,255,255,.10);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, system-ui, sans-serif;
    background: radial-gradient(1200px 700px at 15% 10%, rgba(93,214,255,.12), transparent 60%),
                radial-gradient(900px 600px at 85% 25%, rgba(82,255,168,.10), transparent 65%),
                var(--bg);
    color: var(--text);
  }
  a { color: var(--accent); }
  .wrap {
    max-width: 1200px;
    margin: 0 auto;
    padding: 18px;
  }
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
    overflow: hidden;
  }
  .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 14px 16px;
    background: rgba(0,0,0,.18);
    border-bottom: 1px solid var(--border);
  }
  .title {
    font-weight: 700;
    letter-spacing: .2px;
  }
  .pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: rgba(18,26,41,.7);
    color: var(--muted);
    font-size: 13px;
    white-space: nowrap;
  }
  .timer {
    font-variant-numeric: tabular-nums;
    color: var(--text);
    font-weight: 700;
  }
  .grid {
    display: grid;
    grid-template-columns: 300px 1fr;
    min-height: 72vh;
  }
  @media (max-width: 900px) {
    .grid { grid-template-columns: 1fr; }
  }
  .sidebar {
    padding: 14px;
    background: rgba(18,26,41,.35);
    border-right: 1px solid var(--border);
  }
  @media (max-width: 900px) {
    .sidebar {
      border-right: 0;
      border-bottom: 1px solid var(--border);
    }
  }
  .qnav {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 8px;
  }
  .qbtn {
    appearance: none;
    border: 1px solid var(--border);
    background: rgba(15,22,36,.6);
    color: var(--text);
    border-radius: 10px;
    padding: 10px 0;
    font-weight: 700;
    cursor: pointer;
    transition: transform .05s ease, background .2s ease, border-color .2s ease;
  }
  .qbtn:hover { transform: translateY(-1px); border-color: rgba(93,214,255,.55); }
  .qbtn.active { background: rgba(93,214,255,.18); border-color: rgba(93,214,255,.65); }
  .qbtn.answered { background: rgba(82,255,168,.12); border-color: rgba(82,255,168,.35); }
  .qbtn.flagged { background: rgba(255,93,122,.14); border-color: rgba(255,93,122,.45); }
  .sidebar .meta {
    margin-top: 14px;
    display: grid;
    gap: 10px;
  }
  .metaRow {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 13px;
    color: var(--muted);
  }
  .main {
    padding: 18px;
  }
  .stem {
    font-size: 18px;
    line-height: 1.35;
    margin: 0 0 14px 0;
  }
  .tag {
    font-size: 12px;
    color: var(--muted);
    border: 1px solid var(--border);
    background: rgba(15,22,36,.55);
    display: inline-block;
    padding: 6px 10px;
    border-radius: 999px;
    margin-bottom: 10px;
  }
  .choices {
    display: grid;
    gap: 10px;
  }
  label.choice {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    padding: 12px 12px;
    background: rgba(15,22,36,.55);
    border: 1px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
  }
  label.choice:hover {
    border-color: rgba(93,214,255,.55);
    background: rgba(15,22,36,.72);
  }
  input[type="radio"], input[type="checkbox"] {
    margin-top: 2px;
    accent-color: var(--accent);
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 16px;
  }
  button.btn {
    appearance: none;
    border: 1px solid var(--border);
    background: rgba(18,26,41,.65);
    color: var(--text);
    border-radius: 12px;
    padding: 10px 12px;
    font-weight: 700;
    cursor: pointer;
  }
  button.btn:hover { border-color: rgba(93,214,255,.55); }
  button.primary {
    background: rgba(93,214,255,.18);
    border-color: rgba(93,214,255,.55);
  }
  button.danger {
    background: rgba(255,93,122,.14);
    border-color: rgba(255,93,122,.55);
  }
  button.ok {
    background: rgba(82,255,168,.12);
    border-color: rgba(82,255,168,.45);
  }
  .note {
    color: var(--muted);
    font-size: 13px;
    line-height: 1.35;
  }
  .startScreen {
    max-width: 860px;
    margin: 30px auto;
    padding: 18px;
  }
  .startScreen h1 {
    margin: 0 0 6px 0;
    font-size: 28px;
  }
  .startScreen ul {
    margin: 10px 0 0 18px;
    color: var(--muted);
    line-height: 1.5;
  }
  .hidden { display: none; }
  .calcBox {
    display: grid;
    gap: 10px;
  }
  .calcBox input {
    width: 240px;
    max-width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: rgba(15,22,36,.55);
    color: var(--text);
    font-size: 16px;
  }
  .ordered {
    display: grid;
    gap: 10px;
  }
  .step {
    display: flex;
    gap: 10px;
    align-items: center;
    padding: 10px 12px;
    background: rgba(15,22,36,.55);
    border: 1px solid var(--border);
    border-radius: 12px;
  }
  .step .handle {
    width: 26px;
    height: 26px;
    border-radius: 8px;
    border: 1px solid var(--border);
    display: grid;
    place-items: center;
    color: var(--muted);
    font-weight: 700;
  }
  .step .txt {
    flex: 1;
    line-height: 1.3;
  }
  .step .arrows button {
    margin-left: 6px;
    padding: 6px 8px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: rgba(18,26,41,.65);
    color: var(--text);
    cursor: pointer;
  }
  .results h2 {
    margin: 0 0 6px 0;
  }
  .resultItem {
    padding: 12px 12px;
    border: 1px solid var(--border);
    border-radius: 14px;
    background: rgba(15,22,36,.55);
    margin: 10px 0;
  }
  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 800;
    border: 1px solid var(--border);
    margin-right: 8px;
  }
  .badge.ok { color: var(--ok); border-color: rgba(82,255,168,.35); background: rgba(82,255,168,.12); }
  .badge.no { color: var(--danger); border-color: rgba(255,93,122,.45); background: rgba(255,93,122,.14); }
  .rationale {
    color: var(--muted);
    margin-top: 8px;
    line-height: 1.35;
  }
</style>
</head>
<body>
<div id="start" class="wrap startScreen">
  <div class="card">
    <div class="topbar">
      <div class="title">NCLEX-Style Timed Exam - Pain & Pharmacology (50 Questions)</div>
      <div class="pill"><span>Time:</span> <span class="timer">90:00</span></div>
    </div>
    <div style="padding:16px 18px;">
      <h1>NCLEX-Style Timed Exam — Form C (Balanced)</h1>
      <div class="note">
        <ul>
          <li>This exam runs fully in your browser (works well on a Mac).</li>
          <li>Question types include Multiple Choice, Select-All-That-Apply (SATA), Ordered Response, and Calculations.</li>
          <li>Use the sidebar to jump between questions. You can flag questions for review.</li>
          <li>Your progress is saved automatically in this browser.</li>
          <li>When you submit, you'll see your score plus the answer key and rationales.</li>
        </ul>
      </div>
      <div class="controls" style="margin-top:16px;">
        <button class="btn primary" id="startBtn">Start Exam</button>
        <button class="btn" id="resetBtn">Reset Saved Attempt</button>
      </div>
      <div class="note" style="margin-top:10px;">Tip: For best timing accuracy, keep this tab open during the exam.</div>
    </div>
  </div>
</div>

<div id="exam" class="wrap hidden">
  <div class="card">
    <div class="topbar">
      <div class="title" id="headerTitle">Question</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <div class="pill"><span>Answered:</span> <span id="answeredCount">0</span>/50</div>
        <div class="pill"><span>Flagged:</span> <span id="flaggedCount">0</span></div>
        <div class="pill"><span>Time Left:</span> <span class="timer" id="timer">90:00</span></div>
      </div>
    </div>

    <div class="grid">
      <div class="sidebar">
        <div class="qnav" id="qnav"></div>
        <div class="meta">
          <div class="metaRow"><span>Current</span><span id="curMeta">1 / 50</span></div>
          <div class="metaRow"><span>Type</span><span id="typeMeta">MC</span></div>
          <div class="metaRow"><span>Status</span><span id="statusMeta">Not answered</span></div>
        </div>
        <div class="controls" style="margin-top:12px;">
          <button class="btn" id="flagBtn">Flag / Unflag</button>
          <button class="btn" id="clearBtn">Clear Answer</button>
          <button class="btn danger" id="submitBtn">Submit Exam</button>
        </div>
      </div>

      <div class="main">
        <div class="tag" id="qTag">Type</div>
        <p class="stem" id="stem"></p>
        <div id="interaction"></div>

        <div class="controls">
          <button class="btn" id="prevBtn">Previous</button>
          <button class="btn primary" id="nextBtn">Next</button>
        </div>
        <div class="note" style="margin-top:10px;">Exam note: Answer key and rationales appear after submission.</div>
      </div>
    </div>
  </div>
</div>

<div id="results" class="wrap hidden">
  <div class="card">
    <div class="topbar">
      <div class="title">Results</div>
      <div class="pill"><span>Score:</span> <span class="timer" id="scoreText">0/50</span></div>
    </div>
    <div class="main results" id="resultsBody"></div>
  </div>
</div>

<script>
const QUESTIONS = [{"id": 1, "type": "mc", "stem": "A client with chronic hypertension is prescribed celecoxib for arthritis. Which teaching is most appropriate?", "options": ["This NSAID has no cardiovascular risks.", "Monitor for signs of cardiovascular complications and report chest pain or shortness of breath.", "Take it with alcohol to improve absorption.", "Because it is COX‑2 selective, it can be used safely with any anticoagulant without risk."], "answer": "Monitor for signs of cardiovascular complications and report chest pain or shortness of breath.", "rationale": "Second‑generation (COX‑2 selective) NSAIDs may still carry cardiovascular risk; clients should be taught to monitor/report concerning symptoms."}, {"id": 2, "type": "mc", "stem": "Which assessment finding would make the nurse question administering an NSAID first‑generation medication?", "options": ["BP 168/94 with history of heart failure", "Temperature 101.2°F with no chronic disease", "Mild seasonal allergic rhinitis", "Migraine headache with nausea"], "answer": "BP 168/94 with history of heart failure", "rationale": "First‑generation NSAIDs are contraindicated in hypertension and heart failure due to fluid retention/worsening cardiovascular status."}, {"id": 3, "type": "calc", "stem": "Half‑life calculation: A medication dose is 160 mg with a half‑life of 4 hours. How many mg remain after 16 hours? (Enter a number; no rounding.)", "answer": ["10"], "rationale": "16 hours is four half‑lives (4h each): 160 → 80 → 40 → 20 → 10 mg."}, {"id": 4, "type": "mc", "stem": "A nurse is educating a client on why nitroglycerin is given sublingually rather than swallowed. Which concept explains this?", "options": ["Protein binding", "First‑pass effect", "Therapeutic index", "Half‑life"], "answer": "First‑pass effect", "rationale": "Swallowed nitroglycerin undergoes significant first‑pass metabolism. Sublingual administration bypasses the GI tract and first‑pass effect for rapid action."}, {"id": 5, "type": "sata", "stem": "A client on opioids is at risk for falls. Which nursing actions reduce this risk? Select all that apply.", "options": ["Implement fall precautions and keep call light within reach.", "Teach the client to change positions slowly.", "Encourage the client to ambulate alone to build confidence.", "Assess sedation level before assisting to the bathroom.", "Administer an extra opioid dose before ambulation to prevent pain."], "answer": ["Implement fall precautions and keep call light within reach.", "Teach the client to change positions slowly.", "Assess sedation level before assisting to the bathroom."], "rationale": "Opioids can cause sedation, dizziness, and hypotension; fall precautions, slow position changes, and assessing sedation before mobility reduce risk."}, {"id": 6, "type": "mc", "stem": "A client is prescribed pregabalin for neuropathic pain. Which consideration is most important?", "options": ["It requires routine therapeutic levels for pain control.", "It can cause dizziness/drowsiness; reinforce safety precautions.", "It is contraindicated because it is a controlled substance.", "It has no CNS side effects."], "answer": "It can cause dizziness/drowsiness; reinforce safety precautions.", "rationale": "Pregabalin can cause dizziness and drowsiness; safety teaching is essential. It does not require routine therapeutic drug levels for pain."}, {"id": 7, "type": "calc", "stem": "Steady state: A medication has a half‑life of 5 hours. Approximately how many hours to reach plateau with a maintenance dose? (Enter hours.)", "answer": ["20"], "rationale": "Plateau occurs after ~4 half‑lives: 4 × 5 = 20 hours."}, {"id": 8, "type": "mc", "stem": "A client taking hydrocodone/APAP reports taking additional OTC cold medicine “with acetaminophen.” What is the priority nursing concern?", "options": ["Increased risk of renal stones", "Increased risk of hepatotoxicity from total acetaminophen dose", "Increased risk of serotonin syndrome", "Decreased pain control due to antagonism"], "answer": "Increased risk of hepatotoxicity from total acetaminophen dose", "rationale": "Combining multiple acetaminophen-containing products can exceed safe daily maximum and cause liver injury."}, {"id": 9, "type": "mc", "stem": "A nurse is administering opioids. Which expected physiologic effect is associated with opioids?", "options": ["Mydriasis", "Miosis", "Bronchodilation", "Hyperactive bowel sounds"], "answer": "Miosis", "rationale": "Opioids commonly cause miosis (pinpoint pupils)."}, {"id": 10, "type": "sata", "stem": "Which findings indicate a client may be experiencing acetaminophen toxicity? Select all that apply.", "options": ["Right upper quadrant abdominal pain", "Jaundice", "Elevated liver enzymes (ALT/AST)", "Tinnitus", "Severe diarrhea immediately after one dose"], "answer": ["Right upper quadrant abdominal pain", "Jaundice", "Elevated liver enzymes (ALT/AST)"], "rationale": "Acetaminophen toxicity primarily affects the liver; RUQ pain, jaundice, and elevated ALT/AST are concerning. Tinnitus is more consistent with salicylate toxicity."}, {"id": 11, "type": "mc", "stem": "A client received naloxone for opioid overdose. Which nursing plan is most important after the initial response?", "options": ["Discontinue monitoring once respirations improve.", "Continue close monitoring because naloxone may wear off before the opioid.", "Administer another opioid to prevent pain rebound.", "Encourage the client to ambulate immediately."], "answer": "Continue close monitoring because naloxone may wear off before the opioid.", "rationale": "Naloxone duration may be shorter than many opioids; recurrence of respiratory depression is possible, so ongoing monitoring and repeat dosing may be needed."}, {"id": 12, "type": "calc", "stem": "Half‑life calculation: A client receives 64 mg of a drug with a half‑life of 6 hours. How many mg remain after 18 hours? (Enter a number.)", "answer": ["8"], "rationale": "18 hours is three half‑lives: 64 → 32 → 16 → 8 mg."}, {"id": 13, "type": "mc", "stem": "A nurse evaluates a medication’s onset, peak, and duration. Which statement is correct?", "options": ["Peak is when the medication first begins to work.", "Duration is the length of time the medication has desired effect.", "Onset is the time it takes to be completely eliminated.", "Duration is the highest concentration achieved."], "answer": "Duration is the length of time the medication has desired effect.", "rationale": "Duration refers to how long the medication produces the desired effect."}, {"id": 14, "type": "mc", "stem": "A nurse sees an order for an enteral (swallowed) nitroglycerin tablet for acute chest pain. What should the nurse do first?", "options": ["Administer immediately for rapid relief.", "Hold and clarify the order; oral nitroglycerin undergoes first‑pass effect and is not appropriate for rapid relief.", "Crush the tablet and give via feeding tube.", "Give with food to reduce side effects."], "answer": "Hold and clarify the order; oral nitroglycerin undergoes first‑pass effect and is not appropriate for rapid relief.", "rationale": "Nitroglycerin should be given via routes that bypass first‑pass metabolism (e.g., sublingual) for acute chest pain; clarify inappropriate oral order."}, {"id": 15, "type": "sata", "stem": "A nurse is reviewing contraindications for first‑generation NSAIDs. Which client histories are contraindications? Select all that apply.", "options": ["Asthma", "History of peptic ulcer disease", "Chronic kidney disease", "Heart failure", "Seasonal migraines"], "answer": ["Asthma", "History of peptic ulcer disease", "Chronic kidney disease", "Heart failure"], "rationale": "First‑generation NSAIDs are contraindicated in asthma, GI bleed/PUD, renal impairment, and hypertension/heart failure."}, {"id": 16, "type": "ordered", "stem": "A client with severe pain is prescribed IV morphine. Order the nurse’s actions. (1 = first, 4 = last)", "steps": ["Verify indication, allergies, and last opioid dose; assess baseline RR/LOC and pain.", "Administer IV morphine per policy and monitor during administration.", "Implement safety measures (bed low, call light, assist with ambulation).", "Reassess pain and monitor for adverse effects (RR, LOC, hypotension, nausea)."], "answer_order": [1, 2, 3, 4], "rationale": "Assess first, administer safely, ensure safety due to sedation/hypotension risk, then reassess for effectiveness and adverse effects."}, {"id": 17, "type": "calc", "stem": "A client has taken aspirin 650 mg every 6 hours for 2 days and now reports tinnitus. What is the best nurse action? (Answer: Hold, Continue, or Notify.)", "answer": ["Notify"], "rationale": "Tinnitus is a sign of salicylate toxicity; the nurse should hold further doses and notify the provider. (For this item, ‘Notify’ reflects escalation.)"}, {"id": 18, "type": "mc", "stem": "A client with migraine without aura reports unilateral pulsating pain with photophobia. Which nonpharmacologic intervention is most appropriate?", "options": ["Brightly lit room to improve alertness", "Dark, quiet environment", "High‑intensity exercise", "Large meal with caffeine"], "answer": "Dark, quiet environment", "rationale": "A dark, quiet space can reduce sensory stimulation and help during acute migraine."}, {"id": 19, "type": "mc", "stem": "A nurse is selecting a medication for nerve pain described as burning and shooting. Which class is commonly used?", "options": ["Anticonvulsants such as gabapentin", "Loop diuretics", "Beta blockers", "Antibiotics"], "answer": "Anticonvulsants such as gabapentin", "rationale": "Neuropathic pain (burning/shocking/pins and needles) is often managed with anticonvulsants such as gabapentin or pregabalin."}, {"id": 20, "type": "calc", "stem": "Drug clearance estimate: A drug is stopped. About what percent remains after 5 half‑lives? (Enter percent.)", "answer": ["3.125"], "rationale": "After 5 half‑lives: (1/2)^5 = 1/32 = 3.125% remaining."}, {"id": 21, "type": "mc", "stem": "Which finding best reflects decreased renal excretion increasing drug toxicity risk?", "options": ["Creatinine elevated above baseline", "Albumin elevated", "Hemoglobin elevated", "Sodium slightly low after IV fluids"], "answer": "Creatinine elevated above baseline", "rationale": "Creatinine is a key indicator of kidney function; elevated creatinine suggests impaired excretion and increased toxicity risk."}, {"id": 22, "type": "mc", "stem": "A client taking cyclobenzaprine reports dry mouth and drowsiness. Which category explains dry mouth?", "options": ["Serotonergic effect", "Anticholinergic effect", "Cholinergic effect", "Opioid receptor activation"], "answer": "Anticholinergic effect", "rationale": "Cyclobenzaprine can cause anticholinergic effects such as dry mouth."}, {"id": 23, "type": "sata", "stem": "Which statements about therapeutic window are accurate? Select all that apply.", "options": ["Below the window the drug may be ineffective.", "Within the window the drug is expected to be effective with acceptable risk.", "Above the window the drug may cause harm/toxicity.", "Therapeutic window and therapeutic index are identical terms.", "A narrow window often requires closer monitoring."], "answer": ["Below the window the drug may be ineffective.", "Within the window the drug is expected to be effective with acceptable risk.", "Above the window the drug may cause harm/toxicity.", "A narrow window often requires closer monitoring."], "rationale": "Therapeutic window is the effective range; narrow windows require closer monitoring. Therapeutic index relates to safety ratio and is not identical."}, {"id": 24, "type": "mc", "stem": "A nurse suspects opioid‑induced hypotension. Which assessment supports this?", "options": ["BP 86/48 with dizziness on standing", "Temp 100.9°F", "HR 58 with athletic history", "RR 18 with normal LOC"], "answer": "BP 86/48 with dizziness on standing", "rationale": "Opioids can cause hypotension/orthostatic changes; low BP with dizziness suggests this effect."}, {"id": 25, "type": "calc", "stem": "Safe dosing: An older adult has received acetaminophen 650 mg at 0600, 1200, 1800, and 0000. Using an older-adult max of 3,000 mg/24 hr, can another 650 mg dose be given at 0600? (Answer Yes or No.)", "answer": ["No"], "rationale": "Four doses = 2,600 mg. Another 650 mg would total 3,250 mg in 24 hours, exceeding 3,000 mg."}, {"id": 26, "type": "mc", "stem": "A client with migraine is prescribed topiramate daily. Which is the best evaluation question to assess “working too well”?", "options": ["Are you having fewer migraines per week?", "Are you feeling excessively drowsy or cognitively slowed?", "Do you have tinnitus?", "Are you bleeding when you brush your teeth?"], "answer": "Are you feeling excessively drowsy or cognitively slowed?", "rationale": "Topiramate side effects are CNS related; excessive drowsiness/cognitive slowing suggests the drug may be causing problematic effects."}, {"id": 27, "type": "mc", "stem": "Which nursing action best reflects understanding of drug potency differences among opioids?", "options": ["Administer equal milligram doses of all opioids for similar pain relief.", "Verify dosing units carefully, especially for highly potent opioids ordered in micrograms.", "Assume fentanyl is safest because it is a small dose.", "Avoid reassessment because opioids have predictable effects."], "answer": "Verify dosing units carefully, especially for highly potent opioids ordered in micrograms.", "rationale": "Potency varies; dosing units and amounts differ. Fentanyl is potent and often ordered in micrograms—verification is critical."}, {"id": 28, "type": "mc", "stem": "A client is prescribed an IV antibiotic that is nephrotoxic. Which lab is most important to monitor for toxicity risk?", "options": ["ALT", "Creatinine", "Albumin", "WBC"], "answer": "Creatinine", "rationale": "Creatinine is the key marker for kidney function, which affects drug excretion and nephrotoxic risk."}, {"id": 29, "type": "mc", "stem": "A client with opioid therapy reports urinary retention. What is the nurse’s best first action?", "options": ["Administer a diuretic immediately.", "Assess bladder distention and last void; implement toileting measures and notify provider if needed.", "Ignore; urinary retention is unrelated to opioids.", "Give another opioid to relax the client."], "answer": "Assess bladder distention and last void; implement toileting measures and notify provider if needed.", "rationale": "Urinary retention is a known opioid side effect; assess and manage safely, escalating per protocol if inability to void persists."}, {"id": 30, "type": "sata", "stem": "A client presents with migraine with aura. Which symptoms are consistent with aura? Select all that apply.", "options": ["Flashing lights or zigzag lines", "Numbness/tingling of lips or tongue", "Unilateral weakness", "Diarrhea", "Acute confusion or aphasia"], "answer": ["Flashing lights or zigzag lines", "Numbness/tingling of lips or tongue", "Unilateral weakness", "Acute confusion or aphasia"], "rationale": "Aura can include visual disturbances, sensory changes, aphasia/confusion, and unilateral weakness."}, {"id": 31, "type": "calc", "stem": "Dose stacking: A medication peaks at 1 hour and has a duration of 6 hours. It is scheduled every 4 hours. What is the major concern? (Answer: Under-dose or Overlap.)", "answer": ["Overlap"], "rationale": "Scheduling doses before duration ends can cause overlapping effects (‘stacking’) and increases risk of excessive drug effect/toxicity."}, {"id": 32, "type": "mc", "stem": "A client with low albumin is prescribed a highly protein‑bound drug. What nursing implication is most accurate?", "options": ["Expect decreased drug effect because more drug is bound.", "Expect increased drug effect/toxicity because more free drug is available.", "No change; albumin does not affect drug action.", "Expect only delayed excretion."], "answer": "Expect increased drug effect/toxicity because more free drug is available.", "rationale": "Low albumin reduces binding, increasing free (active) drug and risk for excessive effect/toxicity."}, {"id": 33, "type": "mc", "stem": "Which statement best differentiates side effects from adverse effects?", "options": ["Side effects are rare and always require hospitalization.", "Adverse effects are rare, serious, and always negative; side effects are known and explainable.", "Adverse effects are positive; side effects are negative.", "There is no difference."], "answer": "Adverse effects are rare, serious, and always negative; side effects are known and explainable.", "rationale": "Adverse effects are rare, serious, and negative; side effects are expected/known effects that may be less serious."}, {"id": 34, "type": "mc", "stem": "A nurse is deciding whether to use a Venturi mask or non‑rebreather for a client with respiratory distress. Which is correct?", "options": ["Venturi mask is first‑line for emergency severe hypoxia.", "Non‑rebreather provides high concentration oxygen for emergencies.", "Nasal cannula provides the most precise oxygen delivery.", "Simple mask can be used at any flow rate including 2 L/min."], "answer": "Non‑rebreather provides high concentration oxygen for emergencies.", "rationale": "Non‑rebreather delivers high concentration oxygen and is appropriate in emergencies; Venturi provides precise FiO2 often used when controlled oxygen is needed."}, {"id": 35, "type": "ordered", "stem": "A client with suspected NSAID‑related GI bleed reports black, tarry stools. Order the nurse actions. (1 = first, 4 = last)", "steps": ["Assess vital signs and symptoms of hypovolemia.", "Hold NSAID and notify provider of suspected GI bleeding.", "Prepare for potential labs/IV access as ordered and monitor for worsening.", "Provide client teaching to avoid NSAIDs and report bleeding symptoms."], "answer_order": [1, 2, 3, 4], "rationale": "Assess and stabilize first, then stop the offending medication and notify provider; anticipate orders/monitor, then teach prevention."}, {"id": 36, "type": "calc", "stem": "Half‑life calculation: A client receives 20 mg of a drug with a half‑life of 1 hour. How many mg remain after 6 hours? (Enter a number; no rounding.)", "answer": ["0.3125"], "rationale": "6 hours is six half‑lives: 20 → 10 → 5 → 2.5 → 1.25 → 0.625 → 0.3125 mg."}, {"id": 37, "type": "mc", "stem": "Which client is at highest risk for opioid neurotoxicity and oversedation?", "options": ["Young adult with normal liver/kidney function", "Older adult with renal impairment receiving repeated opioid doses", "Client with seasonal allergies", "Client receiving topical NSAIDs only"], "answer": "Older adult with renal impairment receiving repeated opioid doses", "rationale": "Renal impairment and older age can reduce clearance and increase sensitivity, raising risk for accumulation and neurotoxicity/sedation."}, {"id": 38, "type": "mc", "stem": "A nurse is calculating what remains after half‑lives. Why does prolonged half‑life matter clinically?", "options": ["It always increases drug potency.", "It increases risk for toxicity and may require dose or frequency reduction.", "It means the drug is ineffective.", "It guarantees fewer side effects."], "answer": "It increases risk for toxicity and may require dose or frequency reduction.", "rationale": "Delayed metabolism/excretion prolongs half‑life, increasing accumulation and toxicity risk—dosing adjustments may be needed."}, {"id": 39, "type": "sata", "stem": "A client is discharged with a new opioid prescription. Which education points are essential? Select all that apply.", "options": ["Do not mix with alcohol or other sedatives unless prescribed.", "Use the lowest effective dose and avoid extra doses.", "Expect constipation and start prevention measures.", "Share leftovers with a family member who has pain.", "Store medication locked and dispose of unused tablets properly."], "answer": ["Do not mix with alcohol or other sedatives unless prescribed.", "Use the lowest effective dose and avoid extra doses.", "Expect constipation and start prevention measures.", "Store medication locked and dispose of unused tablets properly."], "rationale": "Key opioid safety: avoid CNS depressants, prevent overdose, prevent constipation, secure storage and safe disposal; never share medications."}, {"id": 40, "type": "mc", "stem": "Which pain description most strongly suggests neuropathic pain rather than nociceptive pain?", "options": ["Dull ache after exercise", "Burning, shooting, pins-and-needles sensation", "Throbbing pain with swelling", "Cramping pain after eating"], "answer": "Burning, shooting, pins-and-needles sensation", "rationale": "Neuropathic pain is often described as burning, shooting, or pins-and-needles."}, {"id": 41, "type": "calc", "stem": "Loading dose concept: A medication would take 30 hours to reach plateau (steady state). Approximately what is the drug’s half‑life? (Enter hours.)", "answer": ["7.5"], "rationale": "Plateau ≈ 4 half‑lives. 30 ÷ 4 = 7.5 hours per half‑life."}, {"id": 42, "type": "mc", "stem": "A client with renal impairment is prescribed a medication primarily excreted by kidneys. Which provider action is most likely?", "options": ["Increase the dose to overcome reduced excretion.", "Decrease dose or extend dosing interval to prevent toxicity.", "Switch to oral route to improve excretion.", "No changes are needed."], "answer": "Decrease dose or extend dosing interval to prevent toxicity.", "rationale": "Impaired renal excretion increases toxicity risk; providers often reduce dose or extend dosing interval."}, {"id": 43, "type": "mc", "stem": "A nurse notes that a medication has a narrow therapeutic index. What is the priority nursing implication?", "options": ["No monitoring is needed because dosing is standardized.", "Monitor closely for toxicity and ensure appropriate lab/parameter monitoring.", "Administer extra doses if not effective immediately.", "Avoid documenting assessments."], "answer": "Monitor closely for toxicity and ensure appropriate lab/parameter monitoring.", "rationale": "Narrow TI drugs have small margin of safety; close monitoring and timely labs/parameters are essential."}, {"id": 44, "type": "calc", "stem": "A drug’s half‑life is 2 hours. Starting with 128 mg, how many mg remain after 10 hours? (Enter a number.)", "answer": ["4"], "rationale": "10 hours is five half‑lives: 128 → 64 → 32 → 16 → 8 → 4 mg."}, {"id": 45, "type": "mc", "stem": "A client reports nausea after morphine. Which nursing intervention is most appropriate?", "options": ["Stop morphine permanently without provider notification.", "Assess severity and request/implement antiemetic as ordered while monitoring for respiratory depression.", "Give alcohol to settle the stomach.", "Encourage driving to distract from nausea."], "answer": "Assess severity and request/implement antiemetic as ordered while monitoring for respiratory depression.", "rationale": "Nausea/vomiting are common opioid side effects; manage symptoms while continuing safety monitoring for more serious effects."}, {"id": 46, "type": "mc", "stem": "Which statement best reflects the nurse’s responsibility regarding CYP450 enzyme specifics?", "options": ["Nurses must memorize which CYP enzyme metabolizes every drug.", "Nurses focus on assessing effectiveness and adverse effects, and report concerns; detailed CYP mapping is pharmacist-level.", "CYP enzymes are only relevant in pediatrics.", "CYP enzymes are found in the kidneys."], "answer": "Nurses focus on assessing effectiveness and adverse effects, and report concerns; detailed CYP mapping is pharmacist-level.", "rationale": "Detailed CYP enzyme mapping is beyond typical nursing scope; nurses monitor response/safety and communicate concerns."}, {"id": 47, "type": "calc", "stem": "Clinical math: A client’s opioid order is morphine 4 mg IV every 2 hours PRN. The vial is 10 mg/mL. How many mL will the nurse draw up for one dose? (Enter mL.)", "answer": ["0.4"], "rationale": "mL = dose ÷ concentration = 4 mg ÷ 10 mg/mL = 0.4 mL."}, {"id": 48, "type": "mc", "stem": "A client’s migraine medication “is not working enough.” What is the nurse’s best first step?", "options": ["Immediately double the dose without provider input.", "Assess timing of administration and whether it was taken at first sign of migraine; evaluate need to notify provider.", "Tell the client to stop all migraine medications.", "Assume the diagnosis is wrong and ignore the complaint."], "answer": "Assess timing of administration and whether it was taken at first sign of migraine; evaluate need to notify provider.", "rationale": "Abortive therapy is most effective when taken early. Assess timing/response and communicate to provider for safe adjustments."}, {"id": 49, "type": "mc", "stem": "Which client statement about NSAIDs indicates a need for further teaching?", "options": ["I’ll watch for black stools or vomiting blood and report it.", "I can take NSAIDs even if I have kidney disease because they are OTC.", "I’ll take it with food to reduce stomach upset.", "I’ll avoid taking more than one NSAID at a time."], "answer": "I can take NSAIDs even if I have kidney disease because they are OTC.", "rationale": "NSAIDs can worsen renal impairment; OTC status does not equal safety in all clients."}, {"id": 50, "type": "mc", "stem": "A nurse is prioritizing client education. Which topic is most important for a client newly prescribed opioids?", "options": ["How to request brand name refills", "Recognition of respiratory depression and when to call 911", "How to increase caffeine intake", "How to avoid sunlight exposure"], "answer": "Recognition of respiratory depression and when to call 911", "rationale": "Respiratory depression is the most dangerous opioid adverse effect; clients must know warning signs and emergency actions."}];
const STORAGE_KEY = "nclex_painpharm_attempt_v1";

function defaultState(){
  return {
    startedAt: null,
    durationSec: 90*60,
    answers: {},
    flagged: {},
    submitted: false
  };
}

function loadState(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return defaultState();
    const s = JSON.parse(raw);
    return Object.assign(defaultState(), s);
  } catch(e) {
    return defaultState();
  }
}

function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function resetState(){
  localStorage.removeItem(STORAGE_KEY);
  state = defaultState();
}

let state = loadState();
let currentIndex = 0;
let tickHandle = null;

function fmtTime(sec){
  sec = Math.max(0, Math.floor(sec));
  const m = Math.floor(sec/60);
  const s = sec%60;
  return String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}

function computeTimeLeft(){
  if(!state.startedAt) return state.durationSec;
  const elapsed = (Date.now() - state.startedAt)/1000;
  return state.durationSec - elapsed;
}

function answeredCount(){
  let c=0;
  for(const q of QUESTIONS){
    const a = state.answers[q.id];
    if(a==null) continue;
    if(q.type==="mc" && typeof a==="string" && a.trim()!=="") c++;
    else if(q.type==="calc" && typeof a==="string" && a.trim()!=="") c++;
    else if(q.type==="sata" && Array.isArray(a) && a.length>0) c++;
    else if(q.type==="ordered" && a && Array.isArray(a.order) && a.order.length===q.steps.length) c++;
  }
  return c;
}

function flaggedCount(){
  return Object.keys(state.flagged).length;
}

function isAnswered(q){
  const a = state.answers[q.id];
  if(a==null) return false;
  if(q.type==="mc" || q.type==="calc") return String(a).trim()!=="";
  if(q.type==="sata") return Array.isArray(a) && a.length>0;
  if(q.type==="ordered") return a && Array.isArray(a.order) && a.order.length===q.steps.length;
  return false;
}

function isCorrect(q){
  const a = state.answers[q.id];
  if(q.type==="calc"){
    const want = String(q.answer[0]).trim();
    const got = String(a ?? "").trim();
    const wantNum = Number(want);
    const gotNum = Number(got);
    if(!Number.isNaN(wantNum) && !Number.isNaN(gotNum)){
      return Math.abs(wantNum - gotNum) <= 0.001;
    }
    return got.toLowerCase() === want.toLowerCase();
  }
  if(q.type==="mc"){
    return String(a) === q.answer[0];
  }
  if(q.type==="sata"){
    const got = Array.isArray(a) ? a.slice().sort() : [];
    const want = q.answer.slice().sort();
    return JSON.stringify(got) === JSON.stringify(want);
  }
  if(q.type==="ordered"){
    const got = (a && Array.isArray(a.order)) ? a.order : [];
    const want = q.answer_order;
    return JSON.stringify(got) === JSON.stringify(want);
  }
  return false;
}

function buildNav(){
  const nav = document.getElementById("qnav");
  nav.innerHTML="";
  for(let i=0;i<QUESTIONS.length;i++){
    const q = QUESTIONS[i];
    const b = document.createElement("button");
    b.className="qbtn";
    b.textContent = String(i+1);
    b.addEventListener("click", ()=>{ currentIndex=i; render(); });
    nav.appendChild(b);
  }
}

function updateNavStyles(){
  const buttons = Array.from(document.querySelectorAll(".qbtn"));
  buttons.forEach((b, i)=>{
    const q = QUESTIONS[i];
    b.classList.toggle("active", i===currentIndex);
    b.classList.toggle("answered", isAnswered(q));
    b.classList.toggle("flagged", !!state.flagged[q.id]);
  });
}

function render(){
  const q = QUESTIONS[currentIndex];
  document.getElementById("headerTitle").textContent = `Question ${currentIndex+1}`;
  document.getElementById("curMeta").textContent = `${currentIndex+1} / ${QUESTIONS.length}`;
  document.getElementById("typeMeta").textContent = q.type.toUpperCase();
  document.getElementById("statusMeta").textContent = isAnswered(q) ? "Answered" : "Not answered";
  document.getElementById("qTag").textContent = ({
    mc:"Multiple Choice",
    sata:"Select all that apply (SATA)",
    ordered:"Ordered response",
    calc:"Calculation / short answer"
  })[q.type] || q.type;

  document.getElementById("stem").textContent = q.stem;

  const area = document.getElementById("interaction");
  area.innerHTML = "";

  if(q.type==="mc" || q.type==="sata"){
    const wrap = document.createElement("div");
    wrap.className="choices";
    const current = state.answers[q.id] ?? (q.type==="sata" ? [] : "");
    q.options.forEach((opt, idx)=>{
      const letter = String.fromCharCode(65+idx);
      const id = `q${q.id}_${letter}`;
      const lab = document.createElement("label");
      lab.className="choice";
      const inp = document.createElement("input");
      inp.type = (q.type==="mc") ? "radio" : "checkbox";
      inp.name = `q${q.id}`;
      inp.id = id;
      inp.value = letter;
      if(q.type==="mc"){
        inp.checked = (current === letter);
      } else {
        inp.checked = Array.isArray(current) && current.includes(letter);
      }
      inp.addEventListener("change", ()=>{
        if(q.type==="mc"){
          state.answers[q.id] = letter;
        } else {
          const arr = new Set(Array.isArray(state.answers[q.id]) ? state.answers[q.id] : []);
          if(inp.checked) arr.add(letter); else arr.delete(letter);
          state.answers[q.id] = Array.from(arr);
        }
        saveState();
        renderMeta();
        updateNavStyles();
      });

      const txt = document.createElement("div");
      txt.innerHTML = `<strong>${letter}.</strong> ${opt}`;
      lab.appendChild(inp);
      lab.appendChild(txt);
      wrap.appendChild(lab);
    });
    area.appendChild(wrap);
  }

  if(q.type==="calc"){
    const box = document.createElement("div");
    box.className="calcBox";
    const inp = document.createElement("input");
    inp.type="text";
    inp.placeholder="Type your answer (e.g., Yes, No, 3.125)";
    inp.value = state.answers[q.id] ?? "";
    inp.addEventListener("input", ()=>{
      state.answers[q.id] = inp.value;
      saveState();
      renderMeta();
      updateNavStyles();
    });
    box.appendChild(inp);
    const hint = document.createElement("div");
    hint.className="note";
    hint.textContent = "Tip: For numeric answers, enter a number (decimals allowed). For Yes/No, type Yes or No.";
    box.appendChild(hint);
    area.appendChild(box);
  }

  if(q.type==="ordered"){
    const ordWrap = document.createElement("div");
    ordWrap.className="ordered";
    let cur = state.answers[q.id]?.order;
    if(!Array.isArray(cur) || cur.length !== q.steps.length){
      cur = Array.from({length:q.steps.length}, (_,i)=> i+1);
      state.answers[q.id] = {order:cur};
      saveState();
    }
    function renderSteps(){
      ordWrap.innerHTML="";
      cur.forEach((stepNum, pos)=>{
        const row = document.createElement("div");
        row.className="step";
        const handle = document.createElement("div");
        handle.className="handle";
        handle.textContent = String(pos+1);
        const txt = document.createElement("div");
        txt.className="txt";
        txt.textContent = q.steps[stepNum-1];
        const arrows = document.createElement("div");
        arrows.className="arrows";
        const up = document.createElement("button");
        up.textContent = "▲";
        up.disabled = pos===0;
        up.addEventListener("click", ()=>{
          const t = cur[pos-1]; cur[pos-1]=cur[pos]; cur[pos]=t;
          state.answers[q.id] = {order:cur};
          saveState();
          renderSteps();
          renderMeta();
          updateNavStyles();
        });
        const dn = document.createElement("button");
        dn.textContent = "▼";
        dn.disabled = pos===cur.length-1;
        dn.addEventListener("click", ()=>{
          const t = cur[pos+1]; cur[pos+1]=cur[pos]; cur[pos]=t;
          state.answers[q.id] = {order:cur};
          saveState();
          renderSteps();
          renderMeta();
          updateNavStyles();
        });
        arrows.appendChild(up);
        arrows.appendChild(dn);
        row.appendChild(handle);
        row.appendChild(txt);
        row.appendChild(arrows);
        ordWrap.appendChild(row);
      });
      const note = document.createElement("div");
      note.className="note";
      note.textContent = "Use the arrows to place the actions in correct order.";
      ordWrap.appendChild(note);
    }
    renderSteps();
    area.appendChild(ordWrap);
  }

  document.getElementById("prevBtn").disabled = currentIndex===0;
  document.getElementById("nextBtn").disabled = currentIndex===QUESTIONS.length-1;

  updateNavStyles();
  renderMeta();
}

function renderMeta(){
  document.getElementById("answeredCount").textContent = answeredCount();
  document.getElementById("flaggedCount").textContent = flaggedCount();
  const q = QUESTIONS[currentIndex];
  document.getElementById("statusMeta").textContent = isAnswered(q) ? "Answered" : "Not answered";
}

function startTimer(){
  if(tickHandle) clearInterval(tickHandle);
  tickHandle = setInterval(()=>{
    const left = computeTimeLeft();
    document.getElementById("timer").textContent = fmtTime(left);
    if(left <= 0){
      clearInterval(tickHandle);
      tickHandle = null;
      submitExam(true);
    }
  }, 250);
}

function submitExam(auto=false){
  if(state.submitted) return;
  if(!auto){
    const ok = confirm("Submit now? You will see answers and rationales.");
    if(!ok) return;
  }
  state.submitted = true;
  saveState();

  let score=0;
  for(const q of QUESTIONS){
    if(isCorrect(q)) score++;
  }

  document.getElementById("exam").classList.add("hidden");
  document.getElementById("results").classList.remove("hidden");
  document.getElementById("scoreText").textContent = `${score}/${QUESTIONS.length}`;

  const body = document.getElementById("resultsBody");
  body.innerHTML = `<p class="note">Auto-grading note: SATA requires an exact match. Ordered response requires the exact sequence. Calculations accept a small numeric tolerance (plus case-insensitive Yes/No).</p>`;

  for(let i=0;i<QUESTIONS.length;i++){
    const q = QUESTIONS[i];
    const ok = isCorrect(q);
    const div = document.createElement("div");
    div.className="resultItem";
    const badge = `<span class="badge ${ok ? "ok":"no"}">${ok ? "Correct":"Incorrect"}</span>`;
    const your = state.answers[q.id];
    let yourTxt = "";
    let correctTxt = "";

    if(q.type==="mc"){
      yourTxt = your ? your : "(no answer)";
      correctTxt = q.answer[0];
    } else if(q.type==="sata"){
      yourTxt = (Array.isArray(your) && your.length) ? your.slice().sort().join(", ") : "(no answer)";
      correctTxt = q.answer.slice().sort().join(", ");
    } else if(q.type==="calc"){
      yourTxt = (your ?? "").toString().trim() || "(no answer)";
      correctTxt = q.answer[0];
    } else if(q.type==="ordered"){
      const y = (your && Array.isArray(your.order)) ? your.order.join("-") : "(no answer)";
      const c = q.answer_order.join("-");
      yourTxt = y;
      correctTxt = c;
    }

    div.innerHTML = `
      <div style="margin-bottom:6px;">
        ${badge}<strong>Q${i+1}.</strong> ${q.stem}
      </div>
      <div class="note"><strong>Your answer:</strong> ${yourTxt} &nbsp;&nbsp; <strong>Correct:</strong> ${correctTxt}</div>
      <div class="rationale"><strong>Rationale:</strong> ${q.rationale}</div>
    `;
    body.appendChild(div);
  }

  body.insertAdjacentHTML("beforeend", `
    <div class="controls" style="margin-top:16px;">
      <button class="btn ok" onclick="window.print()">Print / Save as PDF</button>
      <button class="btn" onclick="resetState(); location.reload();">Start New Attempt</button>
    </div>
  `);
}

document.getElementById("startBtn").addEventListener("click", ()=>{
  if(state.submitted){
    alert("This attempt is already submitted. Use 'Reset Saved Attempt' to start over.");
    return;
  }
  if(!state.startedAt){
    state.startedAt = Date.now();
    saveState();
  }
  document.getElementById("start").classList.add("hidden");
  document.getElementById("exam").classList.remove("hidden");
  buildNav();
  render();
  document.getElementById("timer").textContent = fmtTime(computeTimeLeft());
  startTimer();
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  const ok = confirm("Reset saved attempt? This clears answers and timer for this browser.");
  if(!ok) return;
  resetState();
  location.reload();
});

document.getElementById("prevBtn").addEventListener("click", ()=>{
  if(currentIndex>0) currentIndex--;
  render();
});
document.getElementById("nextBtn").addEventListener("click", ()=>{
  if(currentIndex<QUESTIONS.length-1) currentIndex++;
  render();
});
document.getElementById("flagBtn").addEventListener("click", ()=>{
  const q = QUESTIONS[currentIndex];
  if(state.flagged[q.id]) delete state.flagged[q.id];
  else state.flagged[q.id]=true;
  saveState();
  renderMeta();
  updateNavStyles();
});
document.getElementById("clearBtn").addEventListener("click", ()=>{
  const q = QUESTIONS[currentIndex];
  delete state.answers[q.id];
  if(q.type==="ordered"){
    state.answers[q.id] = {order: Array.from({length:q.steps.length}, (_,i)=> i+1)};
  }
  saveState();
  render();
});
document.getElementById("submitBtn").addEventListener("click", ()=> submitExam(false));

(function init(){
  if(state.submitted){
    document.getElementById("start").classList.add("hidden");
    document.getElementById("results").classList.remove("hidden");
    let score=0;
    for(const q of QUESTIONS) if(isCorrect(q)) score++;
    document.getElementById("scoreText").textContent = `${score}/${QUESTIONS.length}`;
    const body = document.getElementById("resultsBody");
    body.innerHTML = `<p class="note">This attempt was already submitted on this browser.</p>`;
    for(let i=0;i<QUESTIONS.length;i++){
      const q = QUESTIONS[i];
      const ok = isCorrect(q);
      const div = document.createElement("div");
      div.className="resultItem";
      const badge = `<span class="badge ${ok ? "ok":"no"}">${ok ? "Correct":"Incorrect"}</span>`;
      const your = state.answers[q.id];
      let yourTxt="", correctTxt="";
      if(q.type==="mc"){ yourTxt = your ? your : "(no answer)"; correctTxt=q.answer[0]; }
      else if(q.type==="sata"){ yourTxt=(Array.isArray(your)&&your.length)?your.slice().sort().join(", "):"(no answer)"; correctTxt=q.answer.slice().sort().join(", "); }
      else if(q.type==="calc"){ yourTxt=(your??"").toString().trim()||"(no answer)"; correctTxt=q.answer[0]; }
      else if(q.type==="ordered"){ yourTxt=(your&&Array.isArray(your.order))?your.order.join("-"):"(no answer)"; correctTxt=q.answer_order.join("-"); }
      div.innerHTML = `<div style="margin-bottom:6px;">${badge}<strong>Q${i+1}.</strong> ${q.stem}</div>
        <div class="note"><strong>Your answer:</strong> ${yourTxt} &nbsp;&nbsp; <strong>Correct:</strong> ${correctTxt}</div>
        <div class="rationale"><strong>Rationale:</strong> ${q.rationale}</div>`;
      body.appendChild(div);
    }
    body.insertAdjacentHTML("beforeend", `
      <div class="controls" style="margin-top:16px;">
        <button class="btn ok" onclick="window.print()">Print / Save as PDF</button>
        <button class="btn" onclick="resetState(); location.reload();">Start New Attempt</button>
      </div>
    `);
    return;
  }

  if(state.startedAt){
    document.getElementById("start").classList.add("hidden");
    document.getElementById("exam").classList.remove("hidden");
    buildNav();
    render();
    document.getElementById("timer").textContent = fmtTime(computeTimeLeft());
    startTimer();
  }
})();
</script>
</body>
</html>
