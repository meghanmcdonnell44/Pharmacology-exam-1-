<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NCLEX Timed Exam — Form B</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; margin: 0; background:#0b0f14; color:#e7eef7; }
  header { position: sticky; top:0; background:#0f1621; border-bottom:1px solid #223146; padding:14px 18px; z-index:10; }
  .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
  .badge { display:inline-block; padding:6px 10px; border:1px solid #2a3a52; border-radius:999px; background:#101a2a; }
  .btn { cursor:pointer; border:1px solid #2a3a52; background:#15233a; color:#e7eef7; padding:10px 14px; border-radius:10px; font-weight:600; }
  .btn:disabled { opacity:.5; cursor:not-allowed; }
  .btn.secondary { background:#0f1621; }
  .card { background:#0f1621; border:1px solid #223146; border-radius:16px; padding:16px; margin: 14px 0; }
  h1 { font-size: 18px; margin: 0; }
  h2 { font-size: 16px; margin: 0 0 8px 0; }
  p { line-height:1.35; }
  .muted { color:#a9b8cc; }
  .opt { margin:10px 0; padding:10px 10px; border:1px solid #223146; border-radius:12px; background:#0b0f14; }
  label { cursor:pointer; }
  .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  @media (max-width: 740px) { .grid2 { grid-template-columns:1fr; } }
  .qnav { display:flex; flex-wrap:wrap; gap:8px; }
  .qnav button { width:44px; padding:10px 0; text-align:center; border-radius:12px; }
  .qnav button.answered { background:#1a2e1d; border-color:#2c5a33; }
  .qnav button.current { outline: 2px solid #7aa7ff; }
  .hr { height:1px; background:#223146; margin:14px 0; }
  .pill { padding:4px 8px; border-radius:999px; border:1px solid #223146; font-size:12px; color:#a9b8cc; }
  .kpi { font-size: 26px; font-weight:800; }
  .good { color:#7CFFB2; }
  .bad { color:#FF7C7C; }
  input[type="text"] { width: 100%; padding: 10px 12px; border-radius: 12px; border:1px solid #223146; background:#0b0f14; color:#e7eef7; font-size:16px; }
  .small { font-size:12px; }
  .rationale { background:#0b0f14; border:1px solid #223146; border-radius:12px; padding:12px; margin-top:10px; }
  .link { color:#7aa7ff; text-decoration:none; }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <div>
        <h1>NCLEX Timed Exam — Form B</h1>
        <div class="muted small">50 questions • mixed item types • timed • answers & rationales shown after submission</div>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <span class="badge">Time left: <span id="timer">--:--</span></span>
        <button class="btn secondary" id="printBtn" onclick="window.print()" disabled>Print</button>
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <a class="link" href="index.html">← Back to exam selector</a>
  </div>

  <div id="startCard" class="card">
    <h2>Instructions</h2>
    <ul class="muted">
      <li>Time limit: 90 minutes.</li>
      <li>Answer each question. Some are <b>Select all that apply</b>, some are <b>ordered response</b>, and some are <b>calculation</b>.</li>
      <li>Click <b>Submit Exam</b> to see your score, answer key, and rationales.</li>
    </ul>
    <button class="btn" onclick="startExam()">Start Exam</button>
  </div>

  <div id="examArea" style="display:none;">
    <div class="card">
      <div class="row">
        <div class="muted">Question navigation</div>
        <div class="muted small">Green = answered</div>
      </div>
      <div class="hr"></div>
      <div class="qnav" id="qnav"></div>
    </div>

    <div id="questionCard" class="card"></div>

    <div class="card">
      <div class="row">
        <button class="btn secondary" onclick="prevQ()">Previous</button>
        <div class="muted">Progress: <span id="progress">0/50</span></div>
        <button class="btn secondary" onclick="nextQ()">Next</button>
      </div>
      <div class="hr"></div>
      <div class="row">
        <button class="btn" id="submitBtn" onclick="submitExam()">Submit Exam</button>
        <div class="muted small">Submitting ends the timer and reveals rationales.</div>
      </div>
    </div>

    <div id="results" style="display:none;" class="card"></div>
  </div>
</div>

<script>
const EXAM = [{"type": "mc", "prompt": "A client has hypoalbuminemia (albumin 2.3 g/dL) and is prescribed a highly protein‑bound medication. Which outcome should the nurse anticipate?", "options": ["Increased free (active) drug level and increased risk for toxicity", "Decreased free drug level and decreased therapeutic effect", "Accelerated renal excretion leading to subtherapeutic levels", "Reduced bioavailability because the drug cannot cross membranes"], "answer": 0, "rationale": "Low albumin means fewer binding sites → more unbound drug circulates → stronger effect and higher toxicity risk.", "id": 1}, {"type": "mc", "prompt": "The nurse explains first‑pass metabolism. Which route is MOST affected by first‑pass metabolism?", "options": ["Oral (PO)", "Intravenous (IV)", "Transdermal", "Sublingual"], "answer": 0, "rationale": "Oral drugs absorbed from the GI tract go to the liver via portal circulation before reaching systemic circulation.", "id": 2}, {"type": "sata", "prompt": "Which situations make an oral (PO) medication unreliable because absorption is likely reduced? Select all that apply.", "options": ["Profuse watery diarrhea", "Severe hypotension with cool, clammy skin", "Vomiting 5–10 minutes after swallowing the medication", "Intact gag reflex", "NPO status for surgery", "Mild anxiety"], "answer": [0, 1, 2, 4], "rationale": "Diarrhea/vomiting decrease time for absorption; shock decreases GI perfusion; NPO prevents administration. Gag reflex/anxiety don’t reliably reduce absorption.", "id": 3}, {"type": "mc", "prompt": "A medication has a narrow therapeutic index (NTI). Which nursing action is most appropriate?", "options": ["Monitor for toxicity and obtain serum drug levels as ordered", "Teach the client to double the next dose if a dose is missed", "Expect minimal adverse effects at usual doses", "Administer PRN doses without reassessment"], "answer": 0, "rationale": "NTI drugs have a small margin between therapeutic and toxic levels, so close monitoring is essential.", "id": 4}, {"type": "mc", "prompt": "The nurse is preparing to administer hydromorphone. Which assessment is the PRIORITY immediately before giving the dose?", "options": ["Respiratory rate", "Bowel sounds", "Skin turgor", "Pupillary light reflex"], "answer": 0, "rationale": "Opioids can cause respiratory depression; assess breathing first (ABCs).", "id": 5}, {"type": "sata", "prompt": "A client received IV hydromorphone 20 minutes ago. Which findings require immediate intervention? Select all that apply.", "options": ["Respiratory rate 10/min", "New difficult‑to‑arouse somnolence", "Pain score decreased from 9/10 to 3/10", "Oxygen saturation 87% on room air", "BP 86/50 mmHg", "Warm, dry skin"], "answer": [0, 1, 3, 4], "rationale": "RR<12, severe sedation, hypoxemia, and hypotension indicate opioid over‑sedation/respiratory compromise. Pain relief alone is expected.", "id": 6}, {"type": "mc", "prompt": "After naloxone is administered for opioid‑induced respiratory depression, which nursing action is most important?", "options": ["Monitor for recurrent respiratory depression because naloxone may wear off first", "Discharge the client once they are awake", "Administer another opioid to prevent withdrawal", "Encourage oral fluids to speed opioid elimination"], "answer": 0, "rationale": "Naloxone duration is often shorter than the opioid; re‑sedation can occur.", "id": 7}, {"type": "order", "prompt": "A client becomes somnolent after receiving IV hydromorphone. Place the nurse’s actions in priority order.", "options": ["Assess airway and breathing; check respiratory rate", "Provide stimulation and apply oxygen", "Activate rapid response/notify provider per policy", "Prepare and administer naloxone per protocol", "Reassess respirations/LOC and continue monitoring"], "answer": [0, 1, 2, 3, 4], "rationale": "Follow ABCs: assess and support breathing, escalate, reverse with naloxone, then reassess/monitor.", "id": 8}, {"type": "mc", "prompt": "A client asks why naproxen should be taken with food. The nurse’s best response is that naproxen can:", "options": ["Irritate the gastric mucosa and increase GI bleeding risk", "Cause severe hypoglycemia", "Prevent clot formation in all clients", "Increase insulin secretion"], "answer": 0, "rationale": "NSAIDs reduce prostaglandins that protect the stomach lining, increasing irritation and bleeding risk.", "id": 9}, {"type": "sata", "prompt": "Which clients are at highest risk for NSAID‑related complications? Select all that apply.", "options": ["History of peptic ulcer disease", "Chronic kidney disease", "Currently taking warfarin", "Age 19 with seasonal allergies", "Dehydration from vomiting/poor intake", "Wears glasses"], "answer": [0, 1, 2, 4], "rationale": "NSAIDs increase GI bleeding risk and can worsen renal perfusion; anticoagulants increase bleeding; dehydration raises AKI risk.", "id": 10}, {"type": "calc", "prompt": "A client takes acetaminophen 1000 mg every 6 hours around the clock. What total dose (mg) is taken in 24 hours?", "answer": 4000, "tolerance": 0, "unit": "mg", "rationale": "4 doses/day × 1000 mg = 4000 mg/day.", "id": 11}, {"type": "mc", "prompt": "Which lab is most important to monitor in a client receiving high doses of acetaminophen for several days?", "options": ["AST/ALT", "Troponin", "Amylase", "Calcium"], "answer": 0, "rationale": "Acetaminophen toxicity primarily affects the liver; monitor liver enzymes.", "id": 12}, {"type": "mc", "prompt": "A client reports black, tarry stools after taking an NSAID for 2 weeks. What is the nurse’s priority action?", "options": ["Notify the provider; possible GI bleeding", "Reassure the client this is expected", "Administer an antidiarrheal", "Encourage increased fiber intake"], "answer": 0, "rationale": "Melena suggests upper GI bleeding and requires prompt evaluation.", "id": 13}, {"type": "sata", "prompt": "A client is prescribed methylprednisolone for inflammation. Which teaching points should the nurse include? Select all that apply.", "options": ["Do not stop the medication abruptly", "Take with food to decrease GI upset", "Report fever/sore throat promptly", "Expect faster wound healing", "Monitor blood glucose (especially if diabetic)", "Avoid live vaccines without provider guidance"], "answer": [0, 1, 2, 4, 5], "rationale": "Steroids require tapering, increase infection risk and glucose, and affect immune response/vaccines; they can impair wound healing.", "id": 14}, {"type": "mc", "prompt": "Which statement by a client taking methylprednisolone indicates the need for further teaching?", "options": ["I will stop taking it when I feel better.", "I will take it with food.", "I will report signs of infection.", "I will monitor my blood sugar more often."], "answer": 0, "rationale": "Steroids should not be stopped abruptly; tapering is often required to prevent adrenal insufficiency.", "id": 15}, {"type": "mc", "prompt": "Which medication is most appropriate for neuropathic pain (burning/tingling) after shingles?", "options": ["Gabapentin", "Ibuprofen", "Acetaminophen", "Calcium carbonate"], "answer": 0, "rationale": "Gabapentin is commonly used for neuropathic pain; NSAIDs/acetaminophen are less effective for nerve pain.", "id": 16}, {"type": "sata", "prompt": "Which adverse effects should the nurse anticipate with gabapentin therapy? Select all that apply.", "options": ["Dizziness", "Sedation", "Ataxia/unsteady gait", "Severe hypertension", "Falls", "Photosensitivity in most clients"], "answer": [0, 1, 2, 4], "rationale": "Common effects: dizziness, drowsiness, ataxia → fall risk.", "id": 17}, {"type": "mc", "prompt": "A client is prescribed cyclobenzaprine for muscle spasm. Which instruction is priority?", "options": ["Avoid driving until you know how it affects you", "Take on an empty stomach for best absorption", "Increase caffeine to counteract drowsiness", "Stop abruptly after long‑term daily use"], "answer": 0, "rationale": "Cyclobenzaprine causes sedation; safety teaching is priority.", "id": 18}, {"type": "mc", "prompt": "A client taking tramadol reports a seizure history and becomes confused. What is the nurse’s best action?", "options": ["Hold the dose and notify the provider", "Administer the dose and reassess in 2 hours", "Give an additional dose for better control", "Switch to ibuprofen without an order"], "answer": 0, "rationale": "Tramadol can lower seizure threshold; neuro changes + seizure history warrants holding and contacting provider.", "id": 19}, {"type": "mc", "prompt": "A client receives rizatriptan for migraine. Which finding requires immediate follow‑up?", "options": ["Chest tightness and shortness of breath", "Mild nausea", "Sleepiness", "Dry mouth"], "answer": 0, "rationale": "Triptans cause vasoconstriction; chest symptoms may indicate coronary vasospasm/ischemia.", "id": 20}, {"type": "sata", "prompt": "Which conditions are contraindications or major cautions for triptan therapy? Select all that apply.", "options": ["Uncontrolled hypertension", "History of stroke/TIA", "Coronary artery disease", "Seasonal allergic rhinitis", "Use of certain interacting antidepressants/MAOIs (agent‑specific)", "Myopia"], "answer": [0, 1, 2, 4], "rationale": "Avoid triptans in vascular disease and uncontrolled HTN; interactions exist with some agents.", "id": 21}, {"type": "mc", "prompt": "Topiramate is prescribed for migraine prevention. Which teaching is most important?", "options": ["Report new confusion or trouble finding words", "Expect immediate relief within minutes", "Take only when the headache begins", "Increase sodium intake to prevent toxicity"], "answer": 0, "rationale": "Topiramate can cause cognitive slowing; it’s for prevention, not acute abortive relief.", "id": 22}, {"type": "calc", "prompt": "Order: hydromorphone 2 mg IV. Supply: 20 mg/10 mL. How many mL will the nurse administer? (Round to the nearest tenth.)", "answer": 1.0, "tolerance": 0.05, "unit": "mL", "rationale": "Concentration = 20 mg ÷ 10 mL = 2.0 mg/mL. Volume = 2 mg ÷ 2.0 mg/mL = 1.00 mL ≈ 1.0 mL.", "id": 23}, {"type": "calc", "prompt": "Order: ibuprofen 400 mg PO. Available: 200 mg tablets. How many tablets will the nurse administer?", "answer": 2, "tolerance": 0, "unit": "tablets", "rationale": "400 mg ÷ 200 mg/tablet = 2 tablets.", "id": 24}, {"type": "order", "prompt": "The nurse receives report on four clients. Order them from FIRST to LAST to assess.", "options": ["Client received IV opioid and has RR 8/min and is difficult to arouse", "Client taking NSAIDs reports black, tarry stools", "Client with chronic back pain requests scheduled acetaminophen", "Client with migraine requests a dark room and ice pack"], "answer": [0, 1, 3, 2], "rationale": "Breathing compromise is first (ABCs). Suspected GI bleed next. Comfort requests follow.", "id": 25}, {"type": "sata", "prompt": "A client is discharged with both gabapentin and an opioid. Which safety instructions are essential? Select all that apply.", "options": ["Avoid alcohol/other sedatives unless approved", "Change positions slowly to prevent falls", "Do not drive until medication effects are known", "Take extra doses if pain returns early", "Report excessive sleepiness or slowed breathing", "Stop gabapentin abruptly when pain improves"], "answer": [0, 1, 2, 4], "rationale": "Combined CNS depressants increase sedation/respiratory risk and falls. Do not self‑escalate doses; do not stop gabapentin abruptly without guidance.", "id": 26}, {"type": "mc", "prompt": "A client on high‑dose aspirin reports tinnitus and easy bruising. What is the best interpretation?", "options": ["Possible salicylate toxicity and platelet inhibition—requires evaluation", "Expected benign effects—continue therapy", "Signs of dehydration—encourage fluids", "Allergic reaction requiring epinephrine"], "answer": 0, "rationale": "Tinnitus suggests salicylate toxicity; bruising reflects platelet inhibition/bleeding risk.", "id": 27}, {"type": "mc", "prompt": "A client takes NSAIDs chronically and is started on lisinopril. What is the priority concern?", "options": ["Worsening kidney function (AKI risk)", "Severe hypernatremia", "Ototoxicity", "Hypothermia"], "answer": 0, "rationale": "NSAIDs can decrease renal perfusion; combined with ACE inhibitors increases AKI risk, especially with dehydration/diuretics.", "id": 28}, {"type": "mc", "prompt": "Which statement about transdermal medication administration is correct?", "options": ["Applying heat over the patch can increase absorption", "Transdermal meds undergo extensive first‑pass metabolism", "Transdermal route has the fastest onset", "Skin integrity does not affect absorption"], "answer": 0, "rationale": "Heat increases local blood flow and absorption; transdermal avoids first‑pass; onset is not fastest; skin integrity matters.", "id": 29}, {"type": "sata", "prompt": "Teach a client on long‑term NSAIDs to report which symptoms that may indicate GI bleeding? Select all that apply.", "options": ["Black, tarry stools", "Coffee‑ground emesis", "New epigastric pain", "Increased appetite", "Unexplained fatigue/dizziness", "Frequent yawning"], "answer": [0, 1, 2, 4], "rationale": "Melena, coffee‑ground emesis, epigastric pain, and anemia symptoms suggest GI bleeding.", "id": 30}, {"type": "mc", "prompt": "A client on NSAIDs has decreased urine output. What should the nurse do first?", "options": ["Give a diuretic without an order", "Administer the next NSAID dose to control inflammation", "Encourage the client to stop all meds immediately", "Assess vital signs and intake/output"], "answer": 3, "rationale": "Assessment first; decreased urine output may indicate renal impairment or hypovolemia.", "id": 31}, {"type": "sata", "prompt": "Which adverse effects are associated with systemic corticosteroids? Select all that apply.", "options": ["Hyperglycemia", "Increased infection risk", "Fluid retention", "Hypotension in most clients", "Osteoporosis with long use", "Improved immune response"], "answer": [0, 1, 2, 4], "rationale": "Steroids can raise glucose, suppress immunity, cause fluid retention, and contribute to osteoporosis; they do not improve immune response.", "id": 32}, {"type": "mc", "prompt": "Which client description is most consistent with neuropathic pain?", "options": ["Burning, shooting pain with tingling in a dermatomal pattern", "Dull ache that improves with rest", "Cramping pain after eating fatty foods", "Sharp pain only when swallowing"], "answer": 0, "rationale": "Neuropathic pain is often burning/shooting with tingling/numbness.", "id": 33}, {"type": "sata", "prompt": "Which clients are at increased risk for opioid‑induced respiratory depression? Select all that apply.", "options": ["Older adult with COPD", "Client receiving benzodiazepines", "Client with obstructive sleep apnea", "Young adult with sprained ankle and no comorbidities", "Client with head injury and decreased LOC", "Client taking acetaminophen only"], "answer": [0, 1, 2, 4], "rationale": "COPD, sedatives, OSA, and decreased LOC/head injury increase risk.", "id": 34}, {"type": "mc", "prompt": "Which discharge instruction is most appropriate for a client prescribed a triptan?", "options": ["Combine with an NSAID and aspirin for stronger effect without guidance", "Stop antihypertensive medication on migraine days", "Take the medication every day regardless of symptoms", "Seek care for chest pain, shortness of breath, or weakness on one side"], "answer": 3, "rationale": "Triptans can cause serious cardiovascular/neurologic events—seek care for warning signs.", "id": 35}, {"type": "mc", "prompt": "A client on topiramate asks about prevention of kidney stones. Which instruction is best?", "options": ["Increase calcium supplements automatically", "Take with grapefruit juice", "Restrict fluids to prevent swelling", "Maintain adequate hydration unless contraindicated"], "answer": 3, "rationale": "Hydration helps reduce kidney stone risk.", "id": 36}, {"type": "mc", "prompt": "A client has suspected acetaminophen overdose. Which medication does the nurse anticipate?", "options": ["Acetylcysteine", "Flumazenil", "Vitamin K", "Naloxone"], "answer": 0, "rationale": "Acetylcysteine replenishes glutathione and is the antidote for acetaminophen toxicity.", "id": 37}, {"type": "sata", "prompt": "A client taking ibuprofen daily reports ankle swelling and elevated BP. Which explanations are accurate? Select all that apply.", "options": ["NSAIDs can cause sodium/water retention", "NSAIDs can decrease renal blood flow", "NSAIDs can blunt effectiveness of some antihypertensives", "Swelling proves anaphylaxis", "This is unrelated to NSAIDs"], "answer": [0, 1, 2], "rationale": "NSAIDs can impair renal prostaglandins → decreased renal blood flow and fluid retention; may worsen BP/control.", "id": 38}, {"type": "mc", "prompt": "Which teaching is most important for a client prescribed both acetaminophen and prednisone?", "options": ["Take both medications only at bedtime", "Drink grapefruit juice with each dose", "Stop both medications if appetite increases", "Do not exceed daily acetaminophen limits and do not stop prednisone abruptly"], "answer": 3, "rationale": "These are the key safety priorities: hepatotoxicity risk and steroid tapering/adrenal suppression.", "id": 39}, {"type": "mc", "prompt": "A client takes an NSAID and is also prescribed an anticoagulant. Which assessment finding is most concerning?", "options": ["Increased appetite", "Mild drowsiness after lunch", "Dry skin on elbows", "New petechiae and bleeding gums"], "answer": 3, "rationale": "NSAIDs + anticoagulants increase bleeding risk; mucosal bleeding/petechiae are concerning.", "id": 40}, {"type": "mc", "prompt": "Which situation most increases the risk for acetaminophen toxicity?", "options": ["Taking a multivitamin daily", "Taking gabapentin at bedtime", "Taking ibuprofen with food", "Taking acetaminophen plus a cold/flu combo product that also contains acetaminophen"], "answer": 3, "rationale": "Unintentional duplication of acetaminophen across OTC products is a common cause of overdose.", "id": 41}, {"type": "mc", "prompt": "Which assessment best evaluates effectiveness of an analgesic intervention?", "options": ["Nurse notes the client is watching TV", "Family reports the client looked calmer", "Client‑reported pain score reassessed after medication administration", "Blood pressure decreases to baseline"], "answer": 2, "rationale": "Pain is subjective; reassess using the patient's report with the same scale at an appropriate interval.", "id": 42}, {"type": "sata", "prompt": "Teach a client on long‑term NSAIDs to report which symptoms that may indicate GI bleeding? Select all that apply.", "options": ["Black, tarry stools", "Coffee‑ground emesis", "New epigastric pain", "Increased appetite", "Unexplained fatigue/dizziness", "Frequent yawning"], "answer": [0, 1, 2, 4], "rationale": "Melena, coffee‑ground emesis, epigastric pain, and anemia symptoms suggest GI bleeding.", "id": 43}, {"type": "mc", "prompt": "A client on NSAIDs has decreased urine output. What should the nurse do first?", "options": ["Give a diuretic without an order", "Encourage the client to stop all meds immediately", "Administer the next NSAID dose to control inflammation", "Assess vital signs and intake/output"], "answer": 3, "rationale": "Assessment first; decreased urine output may indicate renal impairment or hypovolemia.", "id": 44}, {"type": "sata", "prompt": "Which adverse effects are associated with systemic corticosteroids? Select all that apply.", "options": ["Hyperglycemia", "Increased infection risk", "Fluid retention", "Hypotension in most clients", "Osteoporosis with long use", "Improved immune response"], "answer": [0, 1, 2, 4], "rationale": "Steroids can raise glucose, suppress immunity, cause fluid retention, and contribute to osteoporosis; they do not improve immune response.", "id": 45}, {"type": "mc", "prompt": "Which client description is most consistent with neuropathic pain?", "options": ["Cramping pain after eating fatty foods", "Dull ache that improves with rest", "Burning, shooting pain with tingling in a dermatomal pattern", "Sharp pain only when swallowing"], "answer": 2, "rationale": "Neuropathic pain is often burning/shooting with tingling/numbness.", "id": 46}, {"type": "sata", "prompt": "Which clients are at increased risk for opioid‑induced respiratory depression? Select all that apply.", "options": ["Older adult with COPD", "Client receiving benzodiazepines", "Client with obstructive sleep apnea", "Young adult with sprained ankle and no comorbidities", "Client with head injury and decreased LOC", "Client taking acetaminophen only"], "answer": [0, 1, 2, 4], "rationale": "COPD, sedatives, OSA, and decreased LOC/head injury increase risk.", "id": 47}, {"type": "mc", "prompt": "Which discharge instruction is most appropriate for a client prescribed a triptan?", "options": ["Take the medication every day regardless of symptoms", "Stop antihypertensive medication on migraine days", "Combine with an NSAID and aspirin for stronger effect without guidance", "Seek care for chest pain, shortness of breath, or weakness on one side"], "answer": 3, "rationale": "Triptans can cause serious cardiovascular/neurologic events—seek care for warning signs.", "id": 48}, {"type": "mc", "prompt": "A client on topiramate asks about prevention of kidney stones. Which instruction is best?", "options": ["Take with grapefruit juice", "Maintain adequate hydration unless contraindicated", "Restrict fluids to prevent swelling", "Increase calcium supplements automatically"], "answer": 1, "rationale": "Hydration helps reduce kidney stone risk.", "id": 49}, {"type": "mc", "prompt": "A client has suspected acetaminophen overdose. Which medication does the nurse anticipate?", "options": ["Acetylcysteine", "Vitamin K", "Naloxone", "Flumazenil"], "answer": 0, "rationale": "Acetylcysteine replenishes glutathione and is the antidote for acetaminophen toxicity.", "id": 50}];
let current = 0;
let started = false;
let finished = false;
let endTime = null;
let timerInt = null;
const responses = {};

function fmtTime(sec) {
  const m = Math.floor(sec/60);
  const s = sec%60;
  return String(m).padStart(2,'0') + ":" + String(s).padStart(2,'0');
}

function startExam() {
  if (started) return;
  started = true;
  document.getElementById('startCard').style.display='none';
  document.getElementById('examArea').style.display='block';
  const totalSec = 90*60;
  endTime = Date.now() + totalSec*1000;

  timerInt = setInterval(() => {
    if (!started || finished) return;
    const left = Math.max(0, Math.floor((endTime - Date.now())/1000));
    document.getElementById('timer').textContent = fmtTime(left);
    if (left <= 0) {
      clearInterval(timerInt);
      submitExam(true);
    }
  }, 250);

  buildNav();
  renderQuestion();
}

function buildNav() {
  const nav = document.getElementById('qnav');
  nav.innerHTML = '';
  EXAM.forEach((q, idx) => {
    const b = document.createElement('button');
    b.className = 'btn secondary';
    b.textContent = (idx+1);
    b.onclick = () => { current = idx; renderQuestion(); };
    b.id = 'nav_' + idx;
    nav.appendChild(b);
  });
  updateNav();
}

function updateNav() {
  EXAM.forEach((q, idx) => {
    const b = document.getElementById('nav_' + idx);
    if (!b) return;
    b.classList.toggle('current', idx===current);
    const r = responses[q.id];
    const has = r !== undefined && r !== null && (Array.isArray(r) ? r.length>0 : String(r).trim()!=='');
    b.classList.toggle('answered', has);
  });
  const answered = EXAM.filter(q => {
    const r = responses[q.id];
    if (r===undefined || r===null) return false;
    if (Array.isArray(r)) return r.length>0;
    return String(r).trim()!=='';
  }).length;
  document.getElementById('progress').textContent = answered + "/50";
}

function renderQuestion() {
  const q = EXAM[current];
  const card = document.getElementById('questionCard');
  const typeLabel = (q.type==='mc'?'Multiple Choice': q.type==='sata'?'Select all that apply': q.type==='order'?'Ordered response': 'Calculation');
  let html = `<div class="row"><h2>Question ${current+1}</h2><span class="pill">${typeLabel}</span></div>`;
  html += `<div class="hr"></div>`;
  html += `<p>${q.prompt}</p>`;

  if (q.type === 'mc') {
    const saved = responses[q.id];
    q.options.forEach((opt, i) => {
      const checked = (saved===i) ? 'checked' : '';
      html += `
        <div class="opt">
          <label>
            <input type="radio" name="q_${q.id}" value="${i}" ${checked} onchange="saveMC(${q.id}, ${i})"/>
            <span style="margin-left:8px;">${String.fromCharCode(65+i)}. ${opt}</span>
          </label>
        </div>`;
    });
  } else if (q.type === 'sata') {
    const saved = responses[q.id] || [];
    q.options.forEach((opt, i) => {
      const checked = saved.includes(i) ? 'checked' : '';
      html += `
        <div class="opt">
          <label>
            <input type="checkbox" value="${i}" ${checked} onchange="toggleSATA(${q.id}, ${i})"/>
            <span style="margin-left:8px;">${String.fromCharCode(65+i)}. ${opt}</span>
          </label>
        </div>`;
    });
  } else if (q.type === 'order') {
    const saved = responses[q.id] || [];
    html += `<div class="muted small">Enter the order number for each item (1 = first). All numbers 1–${q.options.length} must be used once.</div>`;
    html += `<div class="hr"></div>`;
    q.options.forEach((step, i) => {
      const val = (saved[i]!==undefined) ? saved[i] : '';
      html += `
        <div class="opt">
          <div class="grid2">
            <div><b>Item ${i+1}</b>: ${step}</div>
            <div>
              <label class="muted small">Order:</label>
              <input type="text" inputmode="numeric" placeholder="1-${q.options.length}" value="${val}" oninput="saveOrder(${q.id}, ${i}, this.value)"/>
            </div>
          </div>
        </div>`;
    });
  } else if (q.type === 'calc') {
    const saved = responses[q.id] || '';
    html += `<div class="muted small">Enter a number${q.unit?(' ('+q.unit+')'):'}.</div>`;
    html += `<div class="hr"></div>`;
    html += `<input type="text" inputmode="decimal" placeholder="Your answer" value="${saved}" oninput="saveCalc(${q.id}, this.value)"/>`;
  }

  card.innerHTML = html;
  updateNav();
}

function saveMC(id, idx) {
  responses[id] = idx;
  updateNav();
}

function toggleSATA(id, idx) {
  if (!responses[id]) responses[id] = [];
  const arr = responses[id];
  const k = arr.indexOf(idx);
  if (k>=0) arr.splice(k,1); else arr.push(idx);
  arr.sort((a,b)=>a-b);
  updateNav();
}

function saveOrder(id, itemIdx, value) {
  if (!responses[id]) responses[id] = [];
  responses[id][itemIdx] = value.replace(/[^0-9]/g,'').slice(0,2);
  updateNav();
}

function saveCalc(id, value) {
  responses[id] = value;
  updateNav();
}

function prevQ() {
  if (current>0) { current--; renderQuestion(); }
}
function nextQ() {
  if (current<EXAM.length-1) { current++; renderQuestion(); }
}

function arraysEqual(a,b) {
  if (a.length!==b.length) return false;
  for (let i=0;i<a.length;i++) if (a[i]!==b[i]) return false;
  return true;
}

function gradeQuestion(q) {
  const r = responses[q.id];
  if (q.type==='mc') return r===q.answer;

  if (q.type==='sata') {
    const rr = Array.isArray(r)? r.slice().sort((a,b)=>a-b) : [];
    const aa = q.answer.slice().sort((a,b)=>a-b);
    return arraysEqual(rr, aa);
  }

  if (q.type==='order') {
    const rr = Array.isArray(r)? r : [];
    const parsed = rr.map(x => parseInt(x,10));
    if (parsed.length !== q.options.length) return false;
    if (parsed.some(x => !Number.isFinite(x))) return false;

    const n = q.options.length;
    const ords = parsed.slice().sort((a,b)=>a-b);
    for (let i=0;i<n;i++) if (ords[i]!==i+1) return false;

    const pairs = parsed.map((ord, itemIdx) => [ord, itemIdx]).sort((a,b)=>a[0]-b[0]);
    const seq = pairs.map(p=>p[1]);
    return arraysEqual(seq, q.answer);
  }

  if (q.type==='calc') {
    const val = parseFloat(String(r).replace(/[^0-9.\-]/g,''));
    if (!Number.isFinite(val)) return false;
    const tol = q.tolerance || 0;
    return Math.abs(val - q.answer) <= tol;
  }

  return false;
}

function formatUserAnswer(q) {
  const r = responses[q.id];
  if (q.type==='mc') {
    return (r===undefined) ? '(no answer)' : String.fromCharCode(65+r);
  }
  if (q.type==='sata') {
    if (!Array.isArray(r) || r.length===0) return '(no selections)';
    return r.map(i=>String.fromCharCode(65+i)).join(', ');
  }
  if (q.type==='order') {
    if (!Array.isArray(r) || r.length===0) return '(no order)';
    return r.map((v,i)=>`Item ${i+1}→${v||'_'}`).join(' • ');
  }
  if (q.type==='calc') {
    if (r===undefined || String(r).trim()==='') return '(no answer)';
    return String(r).trim() + (q.unit?(' '+q.unit):'');
  }
  return '(no answer)';
}

function formatCorrectAnswer(q) {
  if (q.type==='mc') {
    return String.fromCharCode(65+q.answer) + `. ` + q.options[q.answer];
  }
  if (q.type==='sata') {
    return q.answer.map(i=>String.fromCharCode(65+i)+`. `+q.options[i]).join('<br/>');
  }
  if (q.type==='order') {
    return q.answer.map((itemIdx, pos)=>`${pos+1}. Item ${itemIdx+1} — ${q.options[itemIdx]}`).join('<br/>');
  }
  if (q.type==='calc') {
    return `${q.answer}${q.unit?(' '+q.unit):''}`;
  }
  return '';
}

function submitExam(auto=false) {
  if (finished) return;
  finished = true;
  clearInterval(timerInt);
  document.getElementById('submitBtn').disabled = true;
  document.getElementById('printBtn').disabled = false;

  let correct=0;
  const details = EXAM.map(q => {
    const ok = gradeQuestion(q);
    if (ok) correct++;
    return {q, ok};
  });

  const scorePct = Math.round((correct/EXAM.length)*100);
  const res = document.getElementById('results');
  res.style.display='block';

  let html = `<div class="row">
      <div><h2>Results</h2><div class="muted">${auto ? 'Time expired — exam auto‑submitted.' : 'Exam submitted.'}</div></div>
      <div style="text-align:right;">
        <div class="kpi ${scorePct>=75 ? 'good':'bad'}">${correct}/50</div>
        <div class="muted">${scorePct}%</div>
      </div>
    </div>`;
  html += `<div class="hr"></div>`;
  html += `<div class="muted">Answer Key & Rationales</div>`;

  details.forEach((d, idx) => {
    const q = d.q;
    const ok = d.ok;
    const status = ok ? 'Correct' : 'Incorrect';
    const cls = ok ? 'good' : 'bad';

    html += `
      <div class="card" style="margin-top:12px;">
        <div class="row">
          <div><b>Q${idx+1}</b> <span class="pill">${q.type.toUpperCase()}</span></div>
          <div class="${cls}"><b>${status}</b></div>
        </div>
        <div class="hr"></div>
        <div>${q.prompt}</div>
        <div class="rationale">
          <div class="muted small"><b>Your answer:</b> ${formatUserAnswer(q)}</div>
          <div class="muted small" style="margin-top:6px;"><b>Correct answer:</b><br/>${formatCorrectAnswer(q)}</div>
          <div style="margin-top:10px;"><b>Rationale:</b> ${q.rationale}</div>
        </div>
      </div>`;
  });

  res.innerHTML = html;
  res.scrollIntoView({behavior:'smooth'});
}
</script>
</body>
</html>